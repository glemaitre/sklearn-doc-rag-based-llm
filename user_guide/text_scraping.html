
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Text Scraping &#8212; Ragger Duck 0.0.1.dev0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/ragger_duck.css?v=43f9b375" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/css/ragger_duck.css?v=43f9b375" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=75d19225"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=97f0b27d"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/text_scraping';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Retriever" href="information_retrieval.html" />
    <link rel="prev" title="User Guide" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Ragger Duck 0.0.1.dev0 documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Ragger Duck 0.0.1.dev0 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../install.html">
    Getting Started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../references/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../auto_examples/index.html">
    Example gallery
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../whats_new.html">
    Release history
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../about.html">
    About us
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/glemaitre/sklearn-ragger-duck" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../install.html">
    Getting Started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../references/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../auto_examples/index.html">
    Example gallery
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../whats_new.html">
    Release history
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About us
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/glemaitre/sklearn-ragger-duck" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Text Scraping</a></li>
<li class="toctree-l1"><a class="reference internal" href="information_retrieval.html">Retriever</a></li>
<li class="toctree-l1"><a class="reference internal" href="large_language_model.html">Large Language Model</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Text Scraping</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="text-scraping">
<span id="id1"></span><h1>Text Scraping<a class="headerlink" href="#text-scraping" title="Link to this heading">#</a></h1>
<p>In a Retrieval Augmented Generation (RAG) framework, the “document” retrieved and
provided to the Large Language Model (LLM) to generate an answer corresponds to chunks
extracted from the documentation.</p>
<p>The first important aspect is to be aware that the context of the LLM is limited.
Therefore, we need to provide chunks of documentation that are relatively limited and
focused to not reach the context limit.</p>
<p>The most common strategy is to extract chunks of text with a given number of tokens and
an overlap between chunks.</p>
<a class="transparent-image reference internal image-reference" href="../_images/naive_chunks.png"><img alt="../_images/naive_chunks.png" class="transparent-image align-center" src="../_images/naive_chunks.png" style="width: 100%;" />
</a>
<p>The various tutorials to build RAG models use this strategy. While it is a fast way to
get started, it is not the best strategy to get the most out of the scikit-learn
documentation. In the subsequent sections, we present different strategies
specifically designed for certain portions of the scikit-learn documentation.</p>
<section id="api-documentation-scraper">
<span id="api-doc-scraping"></span><h2>API documentation scraper<a class="headerlink" href="#api-documentation-scraper" title="Link to this heading">#</a></h2>
<p>We refer to “API documentation” as the following documentation entry point:
<a class="reference external" href="https://scikit-learn.org/stable/modules/classes.html">https://scikit-learn.org/stable/modules/classes.html</a>.</p>
<p>It corresponds to the documentation of each class and function implemented in
scikit-learn. This documentation is automatically generated from the docstrings of the
classes and functions. These docstrings follow the <code class="docutils literal notranslate"><span class="pre">numpydoc</span></code> formatting. As an example,
we show a generated HTML page containing the documentation of a scikit-learn estimator:</p>
<a class="transparent-image reference internal image-reference" href="../_images/api_doc_generated_html.png"><img alt="../_images/api_doc_generated_html.png" class="transparent-image align-center" src="../_images/api_doc_generated_html.png" style="width: 100%;" />
</a>
<p>Before diving into the chunking mechanism, it is interesting to think about the type of
queries that such documentation can help answer. Indeed, these documentation pages are
intended to provide information about class or function parameters, short usage snippets
of code, and related classes or functions. The narration on these pages is relatively
short, and further discussions are generally provided in the user guide instead. So we
would expect that the chunks of documentation to be useful to answer questions such as:</p>
<ul class="simple">
<li><p>What are the parameters of <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html#sklearn.linear_model.LogisticRegression" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogisticRegression</span></code></a>?</p></li>
<li><p>What are the values of the <code class="docutils literal notranslate"><span class="pre">strategy</span></code> parameter in a dummy classifier?</p></li>
</ul>
<p>Now that we have better framed our expectations, we can think about the chunks
extraction. We could go forward with the naive approach described above. However, it
will fall short to help the LLM answer the questions. Let’s go into an example to
illustrate this point.</p>
<p>Consider the second question above: “What are the values of the <code class="docutils literal notranslate"><span class="pre">strategy</span></code> parameter in
a dummy classifier?” While our retrievers (refer to the section
<a class="reference internal" href="information_retrieval.html#information-retrieval"><span class="std std-ref">Retriever</span></a> of the documentation) are able to get the association
between the <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.dummy.DummyClassifier.html#sklearn.dummy.DummyClassifier" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DummyClassifier</span></code></a> and the strategy parameter, the LLM
will not be able to get this link if the chunk retrieved does not contain this
relationship. Indeed, the naive approach will provide a chunk where strategy could be
mentioned, but it might not belong to the <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.dummy.DummyClassifier.html#sklearn.dummy.DummyClassifier" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DummyClassifier</span></code></a> class.</p>
<p>For instance, we could retrieve the following three chunks that are relatively relevant
to the query:</p>
<p><strong>Chunk #1</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>strategy : {&quot;most_frequent&quot;, &quot;prior&quot;, &quot;stratified&quot;, &quot;uniform&quot;, \
            &quot;constant&quot;}, default=&quot;prior&quot;
        Strategy to use to generate predictions.

        * &quot;most_frequent&quot;: the `predict` method always returns the most
          frequent class label in the observed `y` argument passed to `fit`.
          The `predict_proba` method returns the matching one-hot encoded
          vector.
        * &quot;prior&quot;: the `predict` method always returns the most frequent
          class label in the observed `y` argument passed to `fit` (like
          &quot;most_frequent&quot;). ``predict_proba`` always returns the empirical
          class distribution of `y` also known as the empirical class prior
          distribution.
        * &quot;stratified&quot;: the `predict_proba` method randomly samples one-hot
          vectors from a multinomial distribution parametrized by the empirical
          class prior probabilities.
          The `predict` method returns the class label which got probability
          one in the one-hot vector of `predict_proba`.
          Each sampled row of both methods is therefore independent and
          identically distributed.
        * &quot;uniform&quot;: generates predictions uniformly at random from the list
          of unique classes observed in `y`, i.e. each class has equal
          probability.
        * &quot;constant&quot;: always predicts a constant label that is provided by
          the user. This is useful for metrics that evaluate a non-majority
          class.
</pre></div>
</div>
<p><strong>Chunk #2</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">strategy</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="s2">&quot;quantile&quot;</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">},</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span>
        <span class="n">Strategy</span> <span class="n">to</span> <span class="n">use</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">predictions</span><span class="o">.</span>

        <span class="o">*</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">always</span> <span class="n">predicts</span> <span class="n">the</span> <span class="n">mean</span> <span class="n">of</span> <span class="n">the</span> <span class="n">training</span> <span class="nb">set</span>
        <span class="o">*</span> <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="n">always</span> <span class="n">predicts</span> <span class="n">the</span> <span class="n">median</span> <span class="n">of</span> <span class="n">the</span> <span class="n">training</span> <span class="nb">set</span>
        <span class="o">*</span> <span class="s2">&quot;quantile&quot;</span><span class="p">:</span> <span class="n">always</span> <span class="n">predicts</span> <span class="n">a</span> <span class="n">specified</span> <span class="n">quantile</span> <span class="n">of</span> <span class="n">the</span> <span class="n">training</span> <span class="nb">set</span><span class="p">,</span>
          <span class="n">provided</span> <span class="k">with</span> <span class="n">the</span> <span class="n">quantile</span> <span class="n">parameter</span><span class="o">.</span>
        <span class="o">*</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span> <span class="n">always</span> <span class="n">predicts</span> <span class="n">a</span> <span class="n">constant</span> <span class="n">value</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">provided</span> <span class="n">by</span>
          <span class="n">the</span> <span class="n">user</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Chunk #3</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">strategy</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
    <span class="n">The</span> <span class="n">imputation</span> <span class="n">strategy</span><span class="o">.</span>

    <span class="o">-</span> <span class="n">If</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">then</span> <span class="n">replace</span> <span class="n">missing</span> <span class="n">values</span> <span class="n">using</span> <span class="n">the</span> <span class="n">mean</span> <span class="n">along</span>
      <span class="n">each</span> <span class="n">column</span><span class="o">.</span> <span class="n">Can</span> <span class="n">only</span> <span class="n">be</span> <span class="n">used</span> <span class="k">with</span> <span class="n">numeric</span> <span class="n">data</span><span class="o">.</span>
    <span class="o">-</span> <span class="n">If</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="n">then</span> <span class="n">replace</span> <span class="n">missing</span> <span class="n">values</span> <span class="n">using</span> <span class="n">the</span> <span class="n">median</span> <span class="n">along</span>
      <span class="n">each</span> <span class="n">column</span><span class="o">.</span> <span class="n">Can</span> <span class="n">only</span> <span class="n">be</span> <span class="n">used</span> <span class="k">with</span> <span class="n">numeric</span> <span class="n">data</span><span class="o">.</span>
    <span class="o">-</span> <span class="n">If</span> <span class="s2">&quot;most_frequent&quot;</span><span class="p">,</span> <span class="n">then</span> <span class="n">replace</span> <span class="n">missing</span> <span class="n">using</span> <span class="n">the</span> <span class="n">most</span> <span class="n">frequent</span>
      <span class="n">value</span> <span class="n">along</span> <span class="n">each</span> <span class="n">column</span><span class="o">.</span> <span class="n">Can</span> <span class="n">be</span> <span class="n">used</span> <span class="k">with</span> <span class="n">strings</span> <span class="ow">or</span> <span class="n">numeric</span> <span class="n">data</span><span class="o">.</span>
      <span class="n">If</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">one</span> <span class="n">such</span> <span class="n">value</span><span class="p">,</span> <span class="n">only</span> <span class="n">the</span> <span class="n">smallest</span> <span class="ow">is</span> <span class="n">returned</span><span class="o">.</span>
    <span class="o">-</span> <span class="n">If</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">then</span> <span class="n">replace</span> <span class="n">missing</span> <span class="n">values</span> <span class="k">with</span> <span class="n">fill_value</span><span class="o">.</span> <span class="n">Can</span> <span class="n">be</span>
      <span class="n">used</span> <span class="k">with</span> <span class="n">strings</span> <span class="ow">or</span> <span class="n">numeric</span> <span class="n">data</span><span class="o">.</span>
</pre></div>
</div>
<p>Therefore, the chunks are relevant to the strategy parameter, but they are related to
the <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.dummy.DummyClassifier.html#sklearn.dummy.DummyClassifier" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DummyClassifier</span></code></a>, <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.dummy.DummyRegressor.html#sklearn.dummy.DummyRegressor" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DummyRegressor</span></code></a>, and
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.SimpleImputer.html#sklearn.impute.SimpleImputer" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleImputer</span></code></a> classes.</p>
<p>If we provide such information to a human who is not familiar with the scikit-learn API,
they will not be able to determine which of the above chunks is relevant to answer the
query. If they are experts, they might use their previous knowledge to select the
relevant chunk.</p>
<p>So when it comes to an LLM, you should not expect more than a human: if the LLM has been
trained on similar queries, then it might be able to use the relevant information, but
otherwise, it will not be the case. For example, the Mistral 7b model would only
summarize the information of the chunks and provide an unhelpful answer.</p>
<p>As a straightforward solution to the above problem, we could think that we should go
beyond the naive chunking strategy. For instance, if our chunk contains the associated
class or function to the parameter description, then it will allow us to disambiguate
the information and thus help our LLM answer the relevant question.</p>
<p>As previously stated, scikit-learn uses the <code class="docutils literal notranslate"><span class="pre">numpydoc</span></code> formalism to document the classes
and functions. This library comes with a parser that structures the docstring
information, such that you know about the section, the parameters, the types, etc. We
implemented <a class="reference internal" href="../references/generated/ragger_duck.scraping.APINumPyDocExtractor.html#ragger_duck.scraping.APINumPyDocExtractor" title="ragger_duck.scraping.APINumPyDocExtractor"><code class="xref py py-class docutils literal notranslate"><span class="pre">APINumPyDocExtractor</span></code></a> that leverages this
information to build meaningful chunks of documentation. The chunk size in this case is
not controlled, but because of the nature of the documentation, we know that it will
never be too large.</p>
<p>For example, a chunk created that is going to be relevant to the previous query is the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>source: https://scikit-learn.org/stable/modules/generated/sklearn.dummy.DummyClassifier.html
content: Parameter strategy of sklearn.dummy.DummyClassifier.
strategy is described as &#39;Strategy to use to generate predictions.

* &quot;most_frequent&quot;: the `predict` method always returns the most
  frequent class label in the observed `y` argument passed to `fit`.
  The `predict_proba` method returns the matching one-hot encoded
  vector.
* &quot;prior&quot;: the `predict` method always returns the most frequent
  class label in the observed `y` argument passed to `fit` (like
  &quot;most_frequent&quot;). ``predict_proba`` always returns the empirical
  class distribution of `y` also known as the empirical class prior
  distribution.
* &quot;stratified&quot;: the `predict_proba` method randomly samples one-hot
  vectors from a multinomial distribution parametrized by the empirical
  class prior probabilities.
  The `predict` method returns the class label which got probability
  one in the one-hot vector of `predict_proba`.
  Each sampled row of both methods is therefore independent and
  identically distributed.
* &quot;uniform&quot;: generates predictions uniformly at random from the list
  of unique classes observed in `y`, i.e. each class has equal
  probability.
* &quot;constant&quot;: always predicts a constant label that is provided by
  the user. This is useful for metrics that evaluate a non-majority
  class.

.. versionchanged:: 0.24
    The default value of `strategy` has changed to &quot;prior&quot; in version
    0.24.&#39; and has the following type(s): {&quot;most_frequent&quot;, &quot;prior&quot;, &quot;stratified&quot;,
    &quot;uniform&quot;, &quot;constant&quot;}, default=&quot;prior&quot;
</pre></div>
</div>
<p>By providing chunks that maintain the relationship between the parameter and its
corresponding class, we enable the Mistral 7b model to disambiguate the information and
provide a relevant answer.</p>
<section id="chunk-formatting-leveraging-numpydoc">
<h3>Chunk formatting leveraging <code class="docutils literal notranslate"><span class="pre">numpydoc</span></code><a class="headerlink" href="#chunk-formatting-leveraging-numpydoc" title="Link to this heading">#</a></h3>
<p>In this section, we provide detailed information regarding the formatting used to create
the chunks for classes and functions by leveraging the <code class="docutils literal notranslate"><span class="pre">numpydoc</span></code> formalism. You can
refer to <a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/format.html">the numpydoc documentation</a> have more information
regarding this formalism.</p>
<p>We are creating individual chunks for the following sections:</p>
<ul class="simple">
<li><p>class signature with default parameters</p></li>
<li><p>class short and extended summary</p></li>
<li><p>class parameters description</p></li>
<li><p>class attributes description</p></li>
<li><p>associated class or function in “See Also” section</p></li>
<li><p>class note section</p></li>
<li><p>class example usage</p></li>
<li><p>class references</p></li>
</ul>
<p>For each of these sections, we create a chunk of text in natural language to summarize
the information. A similar approach is used for functions and methods of a class. We
provide an example of chunks extracted for the
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.image.extract_patches_2d.html">sklearn.feature_extraction.image.extract_patches_2d</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sklearn.feature_extraction.image.extract_patches_2d
The parameters of extract_patches_2d with their default values when known are:
image, patch_size, max_patches (default=None), random_state (default=None).
The description of the extract_patches_2d is as follow.
Reshape a 2D image into a collection of patches.
The resulting patches are allocated in a dedicated array.
Read more in the :ref:`User Guide &lt;image_feature_extraction&gt;`.
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Parameter image of sklearn.feature_extraction.image.extract_patches_2d.
image is described as &#39;The original image data. For color images, the last dimension
specifies
the channel: a RGB image would have `n_channels=3`.&#39; and has the following type(s):
ndarray of shape (image_height, image_width) or
(image_height, image_width, n_channels)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Parameter</span> <span class="n">patch_size</span> <span class="n">of</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">feature_extraction</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">extract_patches_2d</span><span class="o">.</span>
<span class="n">patch_size</span> <span class="ow">is</span> <span class="n">described</span> <span class="k">as</span> <span class="s1">&#39;The dimensions of one patch.&#39;</span> <span class="ow">and</span> <span class="n">has</span> <span class="n">the</span> <span class="n">following</span>
<span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="nb">tuple</span> <span class="n">of</span> <span class="nb">int</span> <span class="p">(</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Parameter max_patches of sklearn.feature_extraction.image.extract_patches_2d.
max_patches is described as &#39;The maximum number of patches to extract. If
`max_patches` is a float between 0 and 1, it is taken to be a proportion of the
total number of patches. If `max_patches` is None it corresponds to the total number
of patches that can be extracted.&#39; and has the following type(s): int or float,
default=None
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Parameter random_state of sklearn.feature_extraction.image.extract_patches_2d.
random_state is described as &#39;Determines the random number generator used for
random sampling when `max_patches` is not None. Use an int to make the randomness
deterministic.
See :term:`Glossary &lt;random_state&gt;`.&#39; and has the following type(s): int,
RandomState instance, default=None
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>patches is returned by sklearn.feature_extraction.image.extract_patches_2d.
patches is described as &#39;The collection of patches extracted from the image, where
`n_patches` is either `max_patches` or the total number of patches that can be
extracted.&#39; and has the following type(s): array of shape
(n_patches, patch_height, patch_width) or
(n_patches, patch_height, patch_width, n_channels)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sklearn</span><span class="o">.</span><span class="n">feature_extraction</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">extract_patches_2d</span>
<span class="n">Here</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">usage</span> <span class="n">example</span> <span class="n">of</span> <span class="n">extract_patches_2d</span><span class="p">:</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_sample_image</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sklearn.feature_extraction</span> <span class="kn">import</span> <span class="n">image</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="c1"># Use the array data from the first image in this dataset:</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">one_image</span> <span class="o">=</span> <span class="n">load_sample_image</span><span class="p">(</span><span class="s2">&quot;china.jpg&quot;</span><span class="p">)</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">one_image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">Image</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">427</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">extract_patches_2d</span><span class="p">(</span><span class="n">one_image</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Patches shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">Patches</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">272214</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="c1"># Here are just two of these patches:</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">patches</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">[[[</span><span class="mi">174</span> <span class="mi">201</span> <span class="mi">231</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">174</span> <span class="mi">201</span> <span class="mi">231</span><span class="p">]]</span>
     <span class="p">[[</span><span class="mi">173</span> <span class="mi">200</span> <span class="mi">230</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">173</span> <span class="mi">200</span> <span class="mi">230</span><span class="p">]]]</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">patches</span><span class="p">[</span><span class="mi">800</span><span class="p">])</span>
    <span class="p">[[[</span><span class="mi">187</span> <span class="mi">214</span> <span class="mi">243</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">188</span> <span class="mi">215</span> <span class="mi">244</span><span class="p">]]</span>
     <span class="p">[[</span><span class="mi">187</span> <span class="mi">214</span> <span class="mi">243</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">188</span> <span class="mi">215</span> <span class="mi">244</span><span class="p">]]]</span>
</pre></div>
</div>
</section>
</section>
<section id="user-guide-documentation-scraper">
<h2>User Guide documentation scraper<a class="headerlink" href="#user-guide-documentation-scraper" title="Link to this heading">#</a></h2>
<p>We refer to “User Guide documentation” to the narrative documentation that is
handwritten and provides a detailed explanation of the concepts of machine learning
concept and how those translate into scikit-learn usage. The HTML generated pages are
available at <a class="reference external" href="https://scikit-learn.org/stable/user_guide.html">https://scikit-learn.org/stable/user_guide.html</a>. Each page have the
following look:</p>
<a class="transparent-image reference internal image-reference" href="../_images/user_guide_html.png"><img alt="../_images/user_guide_html.png" class="transparent-image align-center" src="../_images/user_guide_html.png" style="width: 100%;" />
</a>
<p>Here, we observed that the information is not structure as in the API documentation.
The naive approach of chunking is more appropriate.
<a class="reference internal" href="../references/generated/ragger_duck.scraping.UserGuideDocExtractor.html#ragger_duck.scraping.UserGuideDocExtractor" title="ragger_duck.scraping.UserGuideDocExtractor"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserGuideDocExtractor</span></code></a> is a scraper that chunks the
documentation in this manner. It relies on <code class="docutils literal notranslate"><span class="pre">beautifulsoup4</span></code> to parse the HTML content
and recursively chunk the content.</p>
<p>It provides two main parameters <code class="docutils literal notranslate"><span class="pre">chunk_size</span></code> and <code class="docutils literal notranslate"><span class="pre">chunk_overlap</span></code> to controlled the
chunking process. It is quite important to not have too large chunks such that the
number of token does not exceed the limit of the retriever. Otherwise, the embeddings
will just truncate the input. Also, it seems that having a small overlap is beneficial
to not retrieve multiple times the same information.</p>
<p>Here, we can forsee an improvement by parsing the documentation at the section
high-level and perform the chunking within these sections. This improvement could
done in the future.</p>
<p>The class also provides the parameter <code class="docutils literal notranslate"><span class="pre">folders_to_exclude</span></code> to exclude some files or
folders that we don’t want to incorporate into our index.</p>
</section>
<section id="example-gallery-scraper">
<h2>Example gallery scraper<a class="headerlink" href="#example-gallery-scraper" title="Link to this heading">#</a></h2>
<p>The last type of documentation in scikit-learn is the gallery of examples. It
corresponds to a set of python examples that show some usage cases or tutorial-like
examples. These examples are written to follow the formalism of <code class="docutils literal notranslate"><span class="pre">sphinx-gallery</span></code>. The
HTML generated pages are available at
<a class="reference external" href="https://scikit-learn.org/stable/auto_examples/index.html">https://scikit-learn.org/stable/auto_examples/index.html</a>.</p>
<p>We mainly have two types of examples in scikit-learn. The first type are more related to
a usage example as shown below:</p>
<a class="transparent-image reference internal image-reference" href="../_images/example_usage_html.png"><img alt="../_images/example_usage_html.png" class="transparent-image align-center" src="../_images/example_usage_html.png" style="width: 100%;" />
</a>
<p>These examples have a title and a description followed by a single block of code.</p>
<p>The second type of examples are more tutorial-like and have sections with titles and
interlace code blocks with text. An example is shown below:</p>
<a class="transparent-image reference internal image-reference" href="../_images/example_tutorial_html.png"><img alt="../_images/example_tutorial_html.png" class="transparent-image align-center" src="../_images/example_tutorial_html.png" style="width: 100%;" />
</a>
<p><a class="reference internal" href="../references/generated/ragger_duck.scraping.GalleryExampleExtractor.html#ragger_duck.scraping.GalleryExampleExtractor" title="ragger_duck.scraping.GalleryExampleExtractor"><code class="xref py py-class docutils literal notranslate"><span class="pre">GalleryExampleExtractor</span></code></a> is a scraper that chunks these
two types of example. In the first case, it will chunk the title and the description as
an individual block an chunk separately the code block. In the second case, it will
instead parse first the section of the example and create blocks for each section. Then,
we will chunk each block separately. The idea behind this strategy is that a section
of text is usually an introduction or a description of the code that follows it.</p>
</section>
<section id="scraper-api">
<h2>Scraper API<a class="headerlink" href="#scraper-api" title="Link to this heading">#</a></h2>
<p>The different scraper classes have a common API that is the scikit-learn transformer
API. They all implement the method <code class="docutils literal notranslate"><span class="pre">fit</span></code>, <code class="docutils literal notranslate"><span class="pre">transform</span></code>, and <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code>. The
scrappers are stateless and only parameter validation is done during <code class="docutils literal notranslate"><span class="pre">fit</span></code>. All the
processing is happening when calling <code class="docutils literal notranslate"><span class="pre">transform</span></code>.</p>
<p>This API allows to leverage the scikit-learn
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="(in scikit-learn v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pipeline</span></code></a> and for instance to create A pipeline and a
retriever with a unique Python instance.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">User Guide</p>
      </div>
    </a>
    <a class="right-next"
       href="information_retrieval.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Retriever</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-documentation-scraper">API documentation scraper</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chunk-formatting-leveraging-numpydoc">Chunk formatting leveraging <code class="docutils literal notranslate"><span class="pre">numpydoc</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#user-guide-documentation-scraper">User Guide documentation scraper</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-gallery-scraper">Example gallery scraper</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scraper-api">Scraper API</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/glemaitre/sklearn-ragger-duck/edit/main/doc/user_guide/text_scraping.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/user_guide/text_scraping.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2023, G. Lemaitresphinx_copybutton.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>